{{!-- Removed `Currency Symbol` helper from the `paymentCurrency` since some currency are not getting rendered. Hotfix until a permanent solution found --}}
<form class="ui form" {{action on='submit' preventDefault=true}}>
  <table class="ui unstackable very basic compact table" style="margin-bottom: 0">
    <thead class="full-width">
      <tr>
        <th>{{t 'Type'}}</th>
        <th class="four wide">{{t 'Sales Ends'}}</th>
        <th class="ui three wide">{{t 'Price'}}</th>
        <th class="one wide">{{t 'Quantity'}}</th>
        <th class="ui right aligned two wide">{{t 'Subtotal'}}</th>
      </tr>
    </thead>
    <tbody>
      {{#each tickets as |ticket|}}
        {{#unless ticket.isHidden}}
          <tr>
            <td>
              <div class="ui small">
                {{ticket.name}}
                {{#if (eq ticket.type 'donation')}}
                  {{ui-popup tagName="i" class="info icon" content=(concat "Donation value should be between " ticket.minPrice " " eventCurrency " and " ticket.maxPrice " " eventCurrency)}}
                {{/if}}
              </div>
              {{#if ticket.isDescriptionVisible}}
                <small class="ui gray-text tiny">{{ticket.description}}</small>
              {{/if}}
            </td>
            <td>{{moment-format ticket.salesEndsAt 'ddd, DD MMMM YY, h:mm A'}}</td>
            {{#if ticket.discount}}
              <td>
                <div id="{{ticket.id}}_price" class="strike text">
                  {{eventCurrency}} {{format-number ticket.price}}
                </div>
                <div id="{{ticket.id}}_discount">
                  {{eventCurrency}} {{format-number (sub ticket.price ticket.discount)}}
                  {{#if taxInfo}}
                    {{#if showTaxIncludedMessage}}
                      <small class="ui gray-text small">
                        {{t 'includes'}} {{eventCurrency}} {{format-number ticket.includedTaxAmount}}
                      </small>
                    {{else}}
                      <small class="ui gray-text small">
                        + {{eventCurrency}} {{format-number (add (sub ticket.ticketPriceWithTax ticket.price) ticket.discount)}}
                      </small>
                    {{/if}}
                    <div>
                      <small class="ui gray-text tiny aligned right">({{taxInfo.name}})</small>
                    </div>
                  {{/if}}
                </div>
              </td>
            {{else}}
              <td id="{{ticket.id}}_price">
                {{#if (eq ticket.type 'donation') }}
                  <div class="field">
                    {{input type='number' name=ticket.id placeholder=(t 'Enter Donation') min=ticket.minPrice max=ticket.maxPrice value=ticket.price}}<br>
                  </div>
                {{else}}
                  {{eventCurrency}} {{format-number ticket.price}}
                {{/if}}
                {{#if (and taxInfo (not-eq ticket.type 'free'))}}
                  {{#if showTaxIncludedMessage}}
                    <small class="ui gray-text small">
                      {{t 'includes'}} {{eventCurrency}} {{format-number ticket.includedTaxAmount}}
                    </small>
                  {{else}}
                    <small class="ui gray-text small">
                      + {{eventCurrency}} {{format-number (sub ticket.ticketPriceWithTax ticket.price)}}
                    </small>
                  {{/if}}
                  <div>
                    <small class="ui gray-text tiny aligned right">({{taxInfo.name}})</small>
                  </div>
                {{/if}}
              </td>
            {{/if}}
            <td>
              <div class="field">
                {{#ui-dropdown class='compact selection' forceSelection=false onChange=(action 'updateOrder' ticket) as |execute mapper|}}
                  {{input type='hidden' id=(concat ticket.id '_quantity') value=ticket.orderQuantity}}
                  <i class="dropdown icon"></i>
                  <div class="default text">0</div>
                  <div class="menu">
                    <div class="item" data-value="{{map-value mapper 0}}">0</div>
                    {{#each (range ticket.minOrder (add ticket.maxOrder 1)) as |count|}}
                      <div class="item" data-value="{{map-value mapper count}}">{{count}}</div>
                    {{/each}}
                  </div>
                {{/ui-dropdown}}
              </div>
            </td>
            <td id='{{ticket.id}}_subtotal' class="ui right aligned">
              {{#if taxInfo}}
                {{eventCurrency}} {{format-number (mult (sub ticket.ticketPriceWithTax ticket.discount) ticket.orderQuantity)}}
              {{else}}
                {{eventCurrency}} {{format-number (mult (sub ticket.price ticket.discount) ticket.orderQuantity)}}
              {{/if}}
            </td>
          </tr>
        {{/unless}}
      {{/each}}
    </tbody>
    <tfoot class="full-width">
      <tr>
        <th></th>
        <th></th>
        <th></th>
        <th></th>
        <th colspan="4">
          <div class="ui right aligned small primary icon">
            {{t 'Total'}}: {{eventCurrency}} {{format-number total}}
          </div>
        </th>
      </tr>
    </tfoot>
  </table>
  <div class="ui grid">
    {{#if enterPromotionalCode}}
      <div class="ui row">
        <div class="{{if device.isBiggerThanTablet 'right floated eight wide'}} column">
          <div class="field">
            <div class="ui action fluid input">
              {{input type='text' name='promotional_code'
                      value=promotionalCode
                      placeholder=(t 'Promotional Code')
                      readonly=promotionalCodeApplied
                      key-up=(action 'handleKeyPress')
              }}
              {{#unless promotionalCodeApplied}}
                <div role="button" class="ui icon button" {{action 'applyPromotionalCode'}}>
                  <i class="checkmark icon"></i>
                </div>
              {{/unless}}
              <div role="button" class="ui black icon button" {{action 'togglePromotionalCode'}}>
                <i class="remove icon"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    {{else}}
      <div class="ui row">
        <div class="column right aligned">
          {{#if device.isMobile}}
            <div class="ui hidden divider"></div>
          {{/if}}
          <a href="#" {{action 'togglePromotionalCode'}}>{{t 'Enter promotional code'}}</a>
        </div>
      </div>
    {{/if}}
  </div>
  <div class="ui grid">
    <div class="ui row stackable grid">
      <div class="ui less padding thirteen wide computer twelve wide tablet column right aligned floated payment icons">
        <i class="colored american express link icon"></i>
        <i class="colored credit card alternative link icon"></i>
        <i class="colored diners club link icon"></i>
        <i class="colored discover link icon"></i>
        <i class="colored mastercard link icon"></i>
        <i class="colored paypal card link icon"></i>
        <i class="colored visa link icon"></i>
      </div>
      <div class="ui less padding three wide computer four wide tablet column right aligned floated">
        <button id="total" class="ui primary small button less right margin" disabled={{shouldDisableOrderButton}} {{action placeOrder}}>
          {{t 'Order Now'}}
        </button>
      </div>
    </div>
  </div>
</form>

{{modals/login-signup-modal isOpen=isLoginModalOpen
                            isLoading=isLoading
                            createNewUserViaEmail=createNewUserViaEmail
                            loginExistingUser=loginExistingUser
                            userExists=userExists
                            errorMessage=errorMessage
}}

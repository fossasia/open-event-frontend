<form class="ui form {{if this.isLoading 'loading'}}" autocomplete="off" {{action 'moveForward' on='submit' preventDefault=true}} novalidate>
  <div class="ui section divider"></div>
  <div class="grouped fields" id="social-links">
    <label>{{t 'Links & Social Media'}}</label>
    <Widgets::Forms::LinkInput
      @hasLinkName={{true}}
      @fixedName={{true}}
      @linkName={{t "External event URL"}}
      @inputId="external_event_url"
      @segmentedLink={{this.data.event.segmentedExternalEventUrl}}
      @isChild={{unless this.data.event.socialLinks true}}
      @canRemoveItem={{false}}
      @addItem={{action "addItem" "socialLinks" "social-link"}} />

    {{#each this.socialLinks as |socialLink|}}
      <Widgets::Forms::LinkInput
        @hasLinkName={{true}}
        @linkName={{socialLink.name}}
        @inputId={{socialLink.identifier}}
        @segmentedLink={{socialLink.segmentedLink}}
        @isChild={{true}}
        @addItem={{action "addItem" "socialLinks" "social-link"}}
        @removeItem={{action "removeItem" socialLink "socialLinks"}} />
    {{/each}}
  </div>

  <div class="ui section divider"></div>
  <div class="grouped fields">
    <label for="privacy">{{t 'Listing Privacy'}}</label>
    <div class="field">
      <div class="ui radio checkbox">
        {{widgets/forms/radio-button this.value name='privacy' id='privacy_public' value='public' checked=this.data.event.privacy}}
        <label for="privacy_public">
          <strong>{{t 'Public event'}}:</strong>
          {{t 'list this event on this site and search engines'}}
        </label>
      </div>
    </div>
    <div class="field">
      <div class="ui radio checkbox">
        {{widgets/forms/radio-button this.value name='privacy' id='privacy_private' value='private' checked=this.data.event.privacy}}
        <label for="privacy_private">
          <strong>{{t 'Private event'}}:</strong>
          {{t 'do not list this event publicly'}}
        </label>
      </div>
    </div>
  </div>

  <div class="ui section divider"></div>
  <div class="field">
    <div class="ui slider checkbox">
      <Input
@type="checkbox"
@checked={{this.hasCodeOfConduct}}
@id="add_code_of_conduct" />
      <label for="add_code_of_conduct">{{t 'Add Code of Conduct'}}</label>
    </div>
  </div>

  {{#if this.hasCodeOfConduct}}
    <div class="field">
      <label for="code_of_conduct">{{t 'Code of Conduct'}}</label>
      <Widgets::Forms::RichTextEditor
        @textareaId="code_of_conduct"
        @value={{this.data.event.codeOfConduct}}
      />
    </div>
  {{/if}}
  <div class="ui section divider"></div>
  <div class="field">
    <label for="license">
      {{t 'License of Event Data & Content'}}
      ( <i class="fitted help icon link has popup"></i> )
      <div class="ui flowing popup top left transition hidden">
        <div class="ui one column divided grid">
          <div class="column">
            <strong>{{t 'Licenses'}}</strong>
            <div class="ui bulleted list">
              {{#each this.licenses as |license|}}
                <div class="item">
                  <a href="{{license.link}}" target="_blank" rel="noopener noreferrer">
                    {{license.name}}
                  </a>
                </div>
              {{/each}}
            </div>
          </div>
        </div>
      </div>
    </label>
    <div class="ui labeled input">
      <UiDropdown
        @class="fluid search selection"
        @selected={{this.data.event.copyright.licence}}
        @onChange={{action "updateCopyright"}}
        @forceSelection={{false}}
        @fullTextSearch={{true}}>
        <Input
          @type="hidden"
          @id="license"
          @value={{this.data.event.copyright.licence}} 
        />
        <i class="dropdown icon"></i>
        <div class="default text">{{t 'Select License'}}</div>
        <div class="menu">
          {{#each this.licenses as |license|}}
            <div class="item" data-value="{{license.name}}">{{license.name}}</div>
          {{/each}}
        </div>
      </UiDropdown>
      {{#if data.event.copyright.licence}}
        <button type="button" class="ui icon button" {{action 'clearLicense'}}>
          <i class="remove icon"></i>
        </button>
      {{/if}}
    </div>
  </div>
  <br>
  <div class="ui grid">
  <div class="sixteen wide column {{unless this.device.isMobile 'right aligned'}} {{if this.isUserUnverified 'disabled'}}">
    <LinkTo @route="events.view.index" @model={{this.data.event.identifier}} class="red ui three field right labeled small icon button">
      {{t 'Cancel'}}<i class="close icon"></i>
    </LinkTo>
    <button class="ui left labeled small icon button {{if this.isLoading 'disabled'}}" type="button" {{action 'move' 'backwards'}}>
      {{t 'Previous'}}
      <i class="left chevron icon"></i>
    </button>
    <button class="ui right labeled small icon button {{if this.isLoading 'disabled'}}" type="button" {{action 'move' 'forwards'}}>
      {{t 'Next'}}
      <i class="right chevron icon"></i>
    </button>
    {{#if (eq this.data.event.state 'draft')}}
      <button class="ui blue button right labeled icon small right aligned {{if this.isLoading 'disabled'}}" type="button" {{action 'saveDraft'}}>
        {{t 'Save as draft'}} <i class="save icon"></i>
      </button>

    {{else}}
      <button class="ui blue button right labeled icon small right aligned {{if this.isLoading 'disabled'}}" type="button" {{action 'savePublished'}}>
        {{t 'Save'}} <i class="save icon"></i>

    {{/if}}
    {{#if this.data.event.name}}
      <button class="green ui three field right labeled icon button {{if this.isLoading 'disabled'}}" type="button" {{action 'publish'}}>
        {{t 'Publish'}}
        <i class="check icon"></i>

      </button>
    {{/if}}
    </div>
  </div>
  <div class="ui grid">
    <div class="sixteen wide column right aligned">
      {{#if (not this.unsavedEvent)}}
        {{#if (eq this.data.event.state 'draft')}}
          <p> This event is currently not published. It is in draft mode and it is not visible publicly. </p>
        {{else}}
          <p>This event is published. Any changes you make will appear on your live event.</p>
        {{/if}}
      {{/if}}
    </div>
  </div>
  <div class="ui divider"></div>
  <div class="ui grid">
  <div class="sixteen wide column {{unless this.device.isMobile 'right aligned'}} {{if this.isUserUnverified 'disabled'}}">
    {{#if (eq this.data.event.state 'draft')}}
      <a href="{{this.data.event.url}}" target="_blank" rel="noopener" class="ui right labeled small icon button">
        {{t 'Preview'}} <i class="hide icon"></i>
      </a>
    {{else}}
      <a href="{{this.data.event.url}}" target="_blank" rel="noopener" class="green ui right labeled small icon button">
        {{t 'View'}} <i class="unhide icon"></i>
      </a>
    {{/if}}
    {{#if (and this.data.event.locationName ticketsPresent)}}
        <button class="ui button right labeled icon small {{if (eq this.data.event.state 'published') 'orange' 'green'}}" {{action 'openConfirmModal'}}>
          {{#if (eq this.data.event.state 'published')}}
            <i class="ban icon"></i>
            {{t 'Unpublish'}}
          {{else}}
            <i class="check icon"></i>
            {{t 'Publish'}}
          {{/if}}
        </button>
    {{/if}}
  </div>
  </div>
</form>

<Modals::PublishUnpublishModal @isOpen={{this.isPublishUnpublishModalOpen}} @state={{this.data.event.state}} @isEventPublishable='true' @togglePublishState={{action 'togglePublishState'}} />
